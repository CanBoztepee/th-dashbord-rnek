<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>AD Kullanıcı Arama</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4">🧑‍💼 AD Kullanıcı Arama</h2>
    
    <input type="text" id="searchInput" class="form-control mb-3" placeholder="İsim, kullanıcı adı ya da e-posta girin...">

    <ul id="resultsList" class="list-group mb-3"></ul>

    <nav>
      <ul id="pagination" class="pagination"></ul>
    </nav>
  </div>

  <script>
    let users = [];
    let currentPage = 1;
    const usersPerPage = 20;

    async function fetchUsers() {
      try {
        const res = await fetch('/users');
        users = await res.json();
        renderList('');
      } catch (error) {
        console.error('Kullanıcılar alınamadı:', error);
      }
    }

    function renderList(filter) {
      const filtered = users.filter(user =>
        (user.name || '').toLowerCase().includes(filter) ||
        (user.username || '').toLowerCase().includes(filter) ||
        (user.email || '').toLowerCase().includes(filter)
      );

      const totalPages = Math.ceil(filtered.length / usersPerPage);
      currentPage = Math.min(currentPage, totalPages);

      const start = (currentPage - 1) * usersPerPage;
      const end = start + usersPerPage;
      const paginatedUsers = filtered.slice(start, end);

      const listEl = document.getElementById('resultsList');
      listEl.innerHTML = '';

      paginatedUsers.forEach(user => {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.textContent = `${user.name} (${user.username}) - ${user.email || 'e-posta yok'}`;
        listEl.appendChild(li);
      });

      renderPagination(totalPages, filter);
    }

    function renderPagination(totalPages, filter) {
      const paginationEl = document.getElementById('pagination');
      paginationEl.innerHTML = '';

      for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement('li');
        li.className = 'page-item' + (i === currentPage ? ' active' : '');
        const btn = document.createElement('button');
        btn.className = 'page-link';
        btn.textContent = i;
        btn.addEventListener('click', () => {
          currentPage = i;
          renderList(filter);
        });
        li.appendChild(btn);
        paginationEl.appendChild(li);
      }
    }

    document.getElementById('searchInput').addEventListener('input', (e) => {
      currentPage = 1;
      renderList(e.target.value.toLowerCase());
    });

    fetchUsers();
  </script>
</body>
</html>
